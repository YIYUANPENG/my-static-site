<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æœˆç™½ä¸“å±</title>
    <script>
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ˜¯å¦éœ€è¦é‡å®šå‘åˆ°å¼•å¯¼é¡µ
        // ä»…åœ¨ç›´æ¥è®¿é—®æ—¶ä¸é‡å®šå‘ï¼Œé€šè¿‡å¼•å¯¼é¡µè·³è½¬è¿‡æ¥æ—¶ä¼šæ·»åŠ å‚æ•°
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            if (!urlParams.has('fromGuide')) {
                // å¯ä»¥é€‰æ‹©æ˜¯å¦è‡ªåŠ¨é‡å®šå‘
                // window.location.href = 'guide.html';
            }
        });
    </script>
    <style>
          * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
          }
          
          /* å¿ƒå½¢æ¼‚æµ®å…ƒç´ æ ·å¼ */
          .hearts-container {
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              pointer-events: none;
              z-index: 0;
              opacity: 0.7;
          }
          
          .heart {
              position: absolute;
              bottom: -100px;
              background-color: #ff6b81;
              width: 20px;
              height: 20px;
              transform: rotate(45deg);
              opacity: 0.6;
              animation: floatUp linear infinite;
          }
          
          .heart:before,
          .heart:after {
              content: '';
              position: absolute;
              background-color: #ff6b81;
              border-radius: 50%;
              width: 20px;
              height: 20px;
          }
          
          .heart:before {
              top: -10px;
              left: 0;
          }
          
          .heart:after {
              top: 0;
              left: -10px;
          }
          
          @keyframes floatUp {
              0% {
                  transform: translateY(0) rotate(45deg) scale(0.3);
                  opacity: 0;
              }
              10% {
                  opacity: 0.6;
              }
              90% {
                  opacity: 0.6;
              }
              100% {
                  transform: translateY(-100vh) rotate(45deg) scale(1);
                  opacity: 0;
              }
          }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f7f8fa;
            color: #333;
            padding: 20px;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 24px;
            color: #333;
            position: relative;
            display: inline-block;
        }
        
        .header h1::after {
            content: 'â¤ï¸';
            position: absolute;
            right: -25px;
            top: -5px;
            font-size: 20px;
        }
        
        .header p {
            font-size: 14px;
            color: #999;
            margin-top: 5px;
        }
        
        .cards-container {
            position: relative;
            width: 100%;
            height: calc(100vh - 120px);
            overflow: visible;
            padding-bottom: 80px;
        }
        
        .card {
            background-color: white;
            border-radius: 12px;
            padding: 15px 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            position: absolute;
            overflow: hidden;
            transform: scale(0) rotate(0deg);
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            min-width: 120px;
            max-width: 45%;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 14px;
            z-index: 1;
            cursor: pointer;
        }
        
        .card.show {
            transform: scale(1) rotate(var(--rotation));
            opacity: 1;
        }
        
        .card::before {
            content: 'ğŸ’– æç¤º';
            position: absolute;
            top: -5px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            color: #ff6b81;
            z-index: 2;
        }
        
        /* éšæœºé¢œè‰²å°†é€šè¿‡JavaScriptè®¾ç½® */
        
        .card:hover {
            transform: scale(1.05) rotate(0deg);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .more-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #ff6b81;
            color: white;
            border: none;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(255, 107, 129, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        
        .more-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(255, 107, 129, 0.4);
        }
        
        .music-control {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #fff;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }
        
        .music-icon {
            font-size: 16px;
            color: #ff6b81;
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
                overflow: hidden;
            }
            
            .header {
                margin-bottom: 20px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .cards-container {
                height: calc(100vh - 120px);
                overflow: hidden;
            }
            
            .card {
                padding: 10px 12px;
                font-size: 12px;
                /* æ‰‹æœºç«¯å¡ç‰‡å¤§å°å°†ç”±JSåŠ¨æ€è®¾ç½® */
            }
            
            .card::before {
                font-size: 9px;
                top: -3px;
                left: 8px;
                padding: 1px 6px;
            }
            
            .more-btn {
                bottom: 15px;
                right: 15px;
                width: 40px;
                height: 40px;
                font-size: 12px;
            }
            
            .music-control {
                bottom: 15px;
                left: 15px;
                width: 30px;
                height: 30px;
            }
            
            .music-icon {
                font-size: 14px;
            }
            
            .modal-content {
                padding: 15px;
                font-size: 14px;
            }
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            text-align: center;
        }
        
        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #999;
        }
    </style>
</head>
<body>
    <!-- å¿ƒå½¢æ¼‚æµ®å…ƒç´ å®¹å™¨ -->
    <div class="hearts-container"></div>
    <div class="header">
        <h1>æœˆç™½ä¸“å±</h1>
        <p>æ‰“å¼€ä½ çš„æƒŠå–œç›’å­</p>
    </div>
    
    <div class="cards-container" id="cardsContainer">
        <!-- å¡ç‰‡å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </div>
    
    <button class="more-btn" id="moreBtn">æ›´å¤š</button>
    
    <button class="music-control" id="musicControl">
        <span class="music-icon" id="musicIcon">ğŸµ</span>
    </button>
    
    <div class="modal" id="modal">
        <div class="modal-content">
            <button class="close-modal" id="closeModal">Ã—</button>
            <div id="modalContent"></div>
        </div>
    </div>
    
    <audio id="backgroundMusic" loop>
        <source src="./background_music.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        // æç¤ºä¿¡æ¯æ•°ç»„ - æ›´å¤šå†…å®¹ä»¥æ”¯æŒæŒç»­å¼¹çª—
        const messages = [
    "å­¦ä¼šçˆ±è‡ªå·±ï¼Œä¸–ç•Œä¹Ÿä¼šå¯¹ä½ æ¸©æŸ”ä»¥å¾…",
    "ä»Šå¤©çš„é˜³å…‰ï¼Œæ˜¯å¦ç…§äº®äº†ä½ çš„å¿ƒæˆ¿ï¼Ÿ",
    "åˆ«ç†¬å¤œï¼Œæ˜Ÿæ˜Ÿä¹Ÿéœ€è¦ä¼‘æ¯",
    "çæƒœæ¯ä¸€åˆ»ï¼Œæ—¶é—´æ˜¯æœ€ç¾çš„ç¤¼ç‰©",
    "åˆ«å¤ªç´¯å•¦ï¼Œç”Ÿæ´»éœ€è¦å¶å°”çš„æ…µæ‡’",
    "è¦ç›¸ä¿¡è‡ªå·±ï¼Œä½ æ˜¯è‡ªå·±çš„è‹±é›„",
    "ä¿æŒå¾®ç¬‘ï¼Œå®ƒä¼šè®©ä½ çš„ä¸–ç•Œæ›´æ˜äº®",
    "æ¢¦æƒ³æˆçœŸï¼Œåªè¦ä½ ä¸æ”¾å¼ƒè¿½æ±‚",
    "è®°å¾—å¥½å¥½æŠ¤è‚¤ï¼Œç¾ä¸½ä»è‡ªæˆ‘å…³çˆ±å¼€å§‹",
    "å¥½å¥½çˆ±è‡ªå·±ï¼Œå› ä¸ºä½ å€¼å¾—æœ€å¥½çš„",
    "å¥½å¥½ä¼‘æ¯ä¸€ä¸‹å§ï¼Œèº«ä½“å’Œå¿ƒçµéƒ½éœ€è¦å……ç”µ",
    "æ¯ä¸€å¤©éƒ½æ˜¯æ–°çš„å¼€å§‹ï¼Œå¸¦ç€å¸Œæœ›å‰è¡Œ",
    "ä½ å€¼å¾—è¢«æ¸©æŸ”å¯¹å¾…ï¼Œå› ä¸ºä½ æ˜¯ç‹¬ä¸€æ— äºŒçš„",
    "è®°å¾—å¤šå–æ°´ï¼Œä¿æŒç”Ÿå‘½çš„æ´»åŠ›",
    "ä¿æŒå¥½å¿ƒæƒ…ï¼Œè®©å¿«ä¹æˆä¸ºä½ çš„ä¹ æƒ¯",
    "ä½ å¾ˆæ£’ï¼Œç»§ç»­åŠ æ²¹ï¼Œæœªæ¥å±äºä½ ",
    "ç”Ÿæ´»å› ä½ è€Œç¾å¥½ï¼Œä½ çš„å­˜åœ¨å°±æ˜¯å¥‡è¿¹",
    "åšè‡ªå·±å–œæ¬¢çš„äº‹ï¼Œè®©çƒ­æƒ…ç‚¹äº®ç”Ÿæ´»",
    "è®°å¾—æŒ‰æ—¶åƒé¥­ï¼Œå¥åº·æ˜¯å¹¸ç¦çš„åŸºçŸ³",
    "ç»™è‡ªå·±ä¸€ä¸ªæ‹¥æŠ±ï¼Œæ¸©æš–æ¥è‡ªå†…å¿ƒçš„çˆ±",
    "ä½ æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œä¸–ç•Œå› ä½ è€Œä¸åŒ",
    "å‹‡æ•¢åšè‡ªå·±ï¼Œä½ çš„ä¸åŒé€ å°±äº†ä½ çš„ç¾",
    "æœªæ¥å¯æœŸï¼Œæ¢¦æƒ³çš„è·¯ä¸Šä½ å¹¶ä¸å­¤å•",
    "å¼€å¿ƒæœ€é‡è¦ï¼Œè®©ç¬‘å£°æˆä¸ºç”Ÿæ´»çš„ä¸»æ—‹å¾‹",
    "æ¯ä¸€å¤©éƒ½æœ‰å°ç¡®å¹¸ï¼Œç”¨å¿ƒå»å‘ç°å®ƒä»¬",
    "é˜³å…‰æ€»åœ¨é£é›¨åï¼ŒåšæŒå°±ä¼šçœ‹åˆ°å½©è™¹",
    "ä½ æ˜¯æœ€æ£’çš„ï¼Œä½ çš„åŠªåŠ›ç»ˆå°†å¼€èŠ±ç»“æœ",
    "åšæŒå°±æ˜¯èƒœåˆ©ï¼Œæ¯ä¸€ä¸ªæŒ‘æˆ˜éƒ½æ˜¯æˆé•¿çš„æœºä¼š",
    "å¥åº·æœ€é‡è¦ï¼Œå®ƒæ˜¯ä¸€åˆ‡ç¾å¥½çš„å‰æ",
    "å¿«ä¹æ¯ä¸€å¤©ï¼Œè®©ç”Ÿæ´»å……æ»¡é˜³å…‰",
    "äº«å—å½“ä¸‹ï¼Œçæƒœçœ¼å‰çš„æ¯ä¸€åˆ»",
    "ç›¸ä¿¡ç¾å¥½ï¼Œå®ƒä¼šè®©ä½ çš„ä¸–ç•Œæ›´åŠ å…‰æ˜",
    "ä¸å¿˜åˆå¿ƒï¼Œæ–¹å¾—å§‹ç»ˆï¼ŒåšæŒä½ çš„æ¢¦æƒ³",
    "å¿ƒå­˜æ„Ÿæ¿€ï¼Œæ„Ÿæ©çš„å¿ƒä¼šå¸å¼•æ›´å¤šçš„å¹¸ç¦",
    "ç”Ÿæ´»å……æ»¡å¸Œæœ›ï¼Œåªè¦ä½ æ„¿æ„å»è¿½å¯»"
];
        
        // ===== å¼¹çª—é…ç½®å‚æ•° =====
        // ç”¨äºæ§åˆ¶å¼¹çª—çš„æ ¸å¿ƒé…ç½®ï¼Œå½±å“å¼¹çª—é¢‘ç‡ã€æ•°é‡å’Œæ˜¾ç¤ºæ•ˆæœ
        const popupConfig = {
            totalCount: 100, // æ€»å…±å¼¹çª—æ¬¡æ•°
            currentCount: 0, // å½“å‰å¼¹çª—è®¡æ•°
            minInterval: 100, // æœ€å°é—´éš”æ—¶é—´(ms) - å¤§å¹…ç¼©çŸ­å¼¹çª—é—´éš”
            maxInterval: 300, // æœ€å¤§é—´éš”æ—¶é—´(ms) - å¤§å¹…ç¼©çŸ­å¼¹çª—é—´éš”
            screenCoverageTarget: 0.8, // ç›®æ ‡å±å¹•è¦†ç›–ç‡
            activeCards: new Set() // æ´»è·ƒå¡ç‰‡é›†åˆ
        };
        
        // è·å–DOMå…ƒç´ 
        const cardsContainer = document.getElementById('cardsContainer');
        const moreBtn = document.getElementById('moreBtn');
        const musicControl = document.getElementById('musicControl');
        const musicIcon = document.getElementById('musicIcon');
        const backgroundMusic = document.getElementById('backgroundMusic');
        const modal = document.getElementById('modal');
        const modalContent = document.getElementById('modalContent');
        const closeModal = document.getElementById('closeModal');
        
        // ===== å¡ç‰‡ç³»ç»Ÿåˆå§‹åŒ– =====
        // åŠŸèƒ½ï¼šå¯åŠ¨æ•´ä¸ªå¡ç‰‡å±•ç¤ºç³»ç»Ÿï¼Œåˆ›å»ºåˆå§‹å¡ç‰‡å¹¶å¼€å§‹æŒç»­å¼¹çª—
        // ç­–ç•¥ï¼šå…ˆæ‰¹é‡åˆ›å»ºåˆå§‹å¡ç‰‡ï¼Œç„¶åå¯åŠ¨æŒç»­å¼¹çª—æµç¨‹
        function initCards() {
            // å®šä¹‰ç»Ÿä¸€çš„å¼¹çª—é—´éš”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
            const popupInterval = 80;
            
            // å…ˆæ˜¾ç¤ºç¬¬ä¸€æ‰¹å¡ç‰‡ - å¢åŠ åˆå§‹å¡ç‰‡æ•°é‡ä»¥æ›´å¿«è¾¾åˆ°è¦†ç›–ç‡
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    if (popupConfig.currentCount < popupConfig.totalCount) {
                        createRandomCard();
                    }
                }, i * popupInterval); // ä½¿ç”¨ç»Ÿä¸€çš„é—´éš”æ—¶é—´
            }
            
            // å¼€å§‹æŒç»­å¼¹çª—
            startContinuousPopup(popupInterval);
        }
        
        // ===== æŒç»­å¼¹çª—æ§åˆ¶å‡½æ•° =====
        // æ ¸å¿ƒåŠŸèƒ½ï¼šæ§åˆ¶å¡ç‰‡çš„æŒç»­ç”Ÿæˆï¼Œæ ¹æ®å½“å‰è¦†ç›–ç‡å’Œè®¡æ•°å†³å®šæ˜¯å¦ç»§ç»­å¼¹çª—
        // å·¥ä½œæœºåˆ¶ï¼šé€’å½’è°ƒç”¨ï¼Œæ¯æ¬¡æ£€æŸ¥è¦†ç›–ç‡å’Œè®¡æ•°ï¼Œæ§åˆ¶å¼¹çª—èŠ‚å¥
        // @param {number} interval - ç»Ÿä¸€çš„å¼¹çª—é—´éš”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        function startContinuousPopup(interval) {
            if (popupConfig.currentCount >= popupConfig.totalCount) {
                console.log('å¼¹çª—å·²å®Œæˆç›®æ ‡æ¬¡æ•°');
                return;
            }
            
            // æ£€æŸ¥å½“å‰è¦†ç›–ç‡
            const currentCoverage = checkScreenCoverage();
            
            if (currentCoverage < popupConfig.screenCoverageTarget) {
                // ä½¿ç”¨ç»Ÿä¸€çš„é—´éš”æ—¶é—´åˆ›å»ºä¸‹ä¸€ä¸ªå¡ç‰‡
                setTimeout(() => {
                    createRandomCard();
                    startContinuousPopup(interval);
                }, interval);
            } else {
                console.log('å·²è¾¾åˆ°ç›®æ ‡è¦†ç›–ç‡');
                
                // å³ä½¿è¾¾åˆ°è¦†ç›–ç‡ï¼Œä¹Ÿç»§ç»­ä½¿ç”¨ç»Ÿä¸€é—´éš”æ—¶é—´å¼¹çª—ä»¥ä¿æŒèŠ‚å¥ä¸€è‡´æ€§
                setTimeout(() => {
                    if (popupConfig.currentCount < popupConfig.totalCount) {
                        createRandomCard();
                        startContinuousPopup(interval);
                    }
                }, interval);
            }
        }
        
        // ===== éšæœºå†…å®¹å¡ç‰‡ç”Ÿæˆ =====
        // åŠŸèƒ½ï¼šä»æ¶ˆæ¯æ•°ç»„ä¸­éšæœºé€‰æ‹©å†…å®¹åˆ›å»ºå¡ç‰‡
        // ç›®çš„ï¼šç¡®ä¿æ¯æ¬¡å¼¹çª—å†…å®¹å¤šæ ·åŒ–ï¼Œé¿å…é‡å¤
        function createRandomCard() {
            const randomIndex = Math.floor(Math.random() * messages.length);
            createCard(messages[randomIndex], popupConfig.currentCount);
        }
        
        // ===== å±å¹•è¦†ç›–ç‡è®¡ç®— =====
        // åŠŸèƒ½ï¼šè®¡ç®—å½“å‰æ‰€æœ‰å¯è§å¡ç‰‡è¦†ç›–å±å¹•çš„æ¯”ä¾‹
        // ç®—æ³•ï¼šè®¡ç®—æ‰€æœ‰å¡ç‰‡ä¸å®¹å™¨çš„é‡å åŒºåŸŸé¢ç§¯ï¼Œé™¤ä»¥å®¹å™¨æ€»é¢ç§¯
        // ç”¨é€”ï¼šç”¨äºæ§åˆ¶å¼¹çª—é€Ÿåº¦ï¼Œè¾¾åˆ°ç›®æ ‡è¦†ç›–ç‡åå‡é€Ÿ
        function checkScreenCoverage() {
            const containerRect = cardsContainer.getBoundingClientRect();
            const containerArea = containerRect.width * containerRect.height;
            
            let coveredArea = 0;
            document.querySelectorAll('.card.show').forEach(card => {
                const rect = card.getBoundingClientRect();
                // åªè®¡ç®—åœ¨å®¹å™¨å†…çš„éƒ¨åˆ†
                const intersectionArea = Math.max(0, Math.min(rect.right, containerRect.right) - Math.max(rect.left, containerRect.left)) *
                                        Math.max(0, Math.min(rect.bottom, containerRect.bottom) - Math.max(rect.top, containerRect.top));
                coveredArea += intersectionArea;
            });
            
            return coveredArea / containerArea;
        }
        
        // ===== å¡ç‰‡åˆ›å»ºå‡½æ•° =====
        // æ ¸å¿ƒåŠŸèƒ½ï¼šç”Ÿæˆå•ä¸ªå¡ç‰‡å…ƒç´ ï¼Œè®¾ç½®æ ·å¼ã€ä½ç½®å’Œäº¤äº’
        // æŠ€æœ¯è¦ç‚¹ï¼šç»Ÿä¸€å¡ç‰‡å°ºå¯¸ã€éšæœºå®šä½ã€æ·»åŠ åŠ¨ç”»æ•ˆæœã€ç®¡ç†å¡ç‰‡ç”Ÿå‘½å‘¨æœŸ
        function createCard(message, index) {
            const card = document.createElement('div');
            card.className = 'card';
            card.textContent = message;
            card.dataset.id = index;
            
            // éšæœºè°ƒæ•´æ—‹è½¬è§’åº¦
            const rotation = (Math.random() * 8 - 4); // -4 åˆ° 4 åº¦
            card.style.setProperty('--rotation', `${rotation}deg`);
            
            // éšæœºè°ƒæ•´å¡ç‰‡é¢œè‰²
            const colors = [
                '#ffe5e5', '#e5f5ff', '#e5ffe5', '#fff5e5', 
                '#f0e5ff', '#ffe5f0', '#e5fffa', '#fff0e5'
            ];
            const colorIndex = Math.floor(Math.random() * colors.length);
            card.style.backgroundColor = colors[colorIndex];
            
            // è·å–å®¹å™¨å°ºå¯¸
            const containerRect = cardsContainer.getBoundingClientRect();
            
            // ç»Ÿä¸€å¡ç‰Œå¤§å°ï¼Œæ ¹æ®è®¾å¤‡ç±»å‹è°ƒæ•´
            const isMobile = window.innerWidth <= 480;
            const cardWidth = isMobile ? 120 : 160; // ç»Ÿä¸€å®½åº¦
            const cardHeight = isMobile ? 80 : 100; // ç»Ÿä¸€é«˜åº¦
            
            // è®¾ç½®å¡ç‰‡å°ºå¯¸
            card.style.width = `${cardWidth}px`;
            card.style.minWidth = `${cardWidth}px`;
            card.style.maxWidth = `${cardWidth}px`;
            card.style.height = `${cardHeight}px`;
            card.style.minHeight = `${cardHeight}px`;
            
            // è®¡ç®—å¯ç”¨ç©ºé—´å¹¶ç•™å‡ºè¾¹è·
            const maxLeft = containerRect.width - cardWidth - 10;
            const maxTop = containerRect.height - cardHeight - 10;
            
            // ç”Ÿæˆéšæœºä½ç½®ï¼Œç¡®ä¿å¡ç‰‡åœ¨å®¹å™¨å†…
            const left = Math.max(10, Math.min(maxLeft, Math.floor(Math.random() * maxLeft)));
            const top = Math.max(10, Math.min(maxTop, Math.floor(Math.random() * maxTop)));
            
            card.style.left = `${left}px`;
            card.style.top = `${top}px`;
            
            // ç¡®ä¿æ–°å¡ç‰‡æ€»æ˜¯å åœ¨æ—§å¡ç‰‡ä¹‹ä¸Š
            // ä½¿ç”¨å½“å‰è®¡æ•°ä½œä¸ºz-indexï¼Œä¿è¯æ–°åˆ›å»ºçš„å¡ç‰‡æœ‰æ›´é«˜çš„å±‚çº§
            card.style.zIndex = popupConfig.currentCount;
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            card.addEventListener('click', () => {
                showModal(message);
                // ç‚¹å‡»æ—¶æå‡z-index
                card.style.zIndex = 200;
            });
            
            // æ·»åŠ åˆ°å®¹å™¨
            cardsContainer.appendChild(card);
            
            // æ›´æ–°æ´»è·ƒå¡ç‰‡é›†åˆ
            popupConfig.activeCards.add(card);
            popupConfig.currentCount++;
            
            // è§¦å‘æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                card.classList.add('show');
            }, 10);
            
            // å–æ¶ˆè‡ªåŠ¨ç§»é™¤å¡ç‰‡çš„æœºåˆ¶ï¼Œç¡®ä¿æ‰€æœ‰å¼¹çª—éƒ½èƒ½ä¿æŒæ˜¾ç¤ºåœ¨å±å¹•ä¸Š
            // æ³¨æ„ï¼šå½“å¼¹çª—æ•°é‡éå¸¸å¤šæ—¶å¯èƒ½ä¼šå½±å“æ€§èƒ½ï¼Œä½†è¿™èƒ½ç¡®ä¿ç”¨æˆ·çœ‹åˆ°æ‰€æœ‰å¼¹çª—
        }
        
        // ===== æ¨¡æ€æ¡†æ˜¾ç¤ºåŠŸèƒ½ =====
        // åŠŸèƒ½ï¼šå¡ç‰‡ç‚¹å‡»æ—¶æ˜¾ç¤ºå¤§å›¾æ¨¡å¼ï¼Œçªå‡ºæ˜¾ç¤ºæ¶ˆæ¯å†…å®¹
        // äº¤äº’ï¼šé˜»æ­¢èƒŒæ™¯æ»šåŠ¨ï¼Œæå‡ç”¨æˆ·æ³¨æ„åŠ›
        function showModal(message) {
            modalContent.textContent = message;
            modal.style.display = 'flex';
            
            // é˜»æ­¢èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = 'hidden';
        }
        
        // ===== æ¨¡æ€æ¡†å…³é—­åŠŸèƒ½ =====
        // åŠŸèƒ½ï¼šéšè—æ¨¡æ€æ¡†ï¼Œæ¢å¤ç•Œé¢çŠ¶æ€
        // æ³¨æ„ï¼šä¿æŒbodyä¸ºhiddenï¼Œç¡®ä¿å¼¹çª—æ•ˆæœæ­£å¸¸
        function hideModal() {
            modal.style.display = 'none';
            // ä¿æŒbodyä¸ºhiddenï¼Œç¡®ä¿å¼¹çª—æ•ˆæœæ­£å¸¸
            document.body.style.overflow = 'hidden';
        }
        
        
        // ===== éŸ³ä¹æ’­æ”¾æ§åˆ¶ =====
        // åŠŸèƒ½ï¼šæ§åˆ¶èƒŒæ™¯éŸ³ä¹çš„æ’­æ”¾å’Œæš‚åœ
        // äº¤äº’ï¼šç‚¹å‡»éŸ³ä¹å›¾æ ‡æ—¶åˆ‡æ¢æ’­æ”¾çŠ¶æ€å’Œå›¾æ ‡æ ·å¼
        function toggleMusic() {
            if (backgroundMusic.paused) {
                backgroundMusic.play();
                musicIcon.textContent = 'ğŸ¶';
            } else {
                backgroundMusic.pause();
                musicIcon.textContent = 'ğŸµ';
            }
        }
        
        // ===== éŸ³é¢‘è‡ªåŠ¨æ’­æ”¾å¤„ç† =====
        // åŠŸèƒ½ï¼šé¡µé¢åŠ è½½åè‡ªåŠ¨å°è¯•æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼Œè®¾ç½®é”™è¯¯å¤„ç†å’ŒéŸ³é‡æ§åˆ¶
        // æ³¨æ„ï¼šç”±äºæµè§ˆå™¨ç­–ç•¥ï¼Œè‡ªåŠ¨æ’­æ”¾å¯èƒ½å¤±è´¥ï¼Œä½†ä¸ä¼šå½±å“æ ¸å¿ƒåŠŸèƒ½
        function attemptAutoPlay() {
            // åªå°è¯•ä¸€æ¬¡
            if (window.hasAttemptedPlay) return;
            window.hasAttemptedPlay = true;
            
            // æ·»åŠ é”™è¯¯å¤„ç†ï¼Œç¡®ä¿éŸ³ä¹åŠ è½½å¤±è´¥ä¸å½±å“é¡µé¢åŠŸèƒ½
            backgroundMusic.addEventListener('error', () => {
                console.log('éŸ³ä¹æ–‡ä»¶åŠ è½½å¤±è´¥ï¼Œä½†é¡µé¢ä»ç„¶å¯ä»¥æ­£å¸¸ä½¿ç”¨');
                musicControl.style.opacity = '0.5';
            });
            
            // å°è¯•æ’­æ”¾å¹¶è®¾ç½®éŸ³é‡
            backgroundMusic.volume = 0.3; // è®¾ç½®é€‚å½“éŸ³é‡
            backgroundMusic.play().then(() => {
                console.log('éŸ³ä¹è‡ªåŠ¨æ’­æ”¾æˆåŠŸ');
                musicIcon.textContent = 'ğŸ¶';
            }).catch(e => {
                console.log('è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’:', e);
            });
        }
        
        // ===== é¡µé¢åˆå§‹åŒ– =====
        // åŠŸèƒ½ï¼šé¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½æ¨¡å—
        // æ‰§è¡Œé¡ºåºï¼šå¯åŠ¨å¼¹çª—ç³»ç»Ÿã€é…ç½®äº¤äº’äº‹ä»¶ã€å°è¯•éŸ³ä¹è‡ªåŠ¨æ’­æ”¾
        document.addEventListener('DOMContentLoaded', () => {
            // å¯åŠ¨æŒç»­å¼¹çª—
            initCards();
            
            // ç¦ç”¨æ›´å¤šæŒ‰é’®ï¼Œå› ä¸ºç°åœ¨æ˜¯è‡ªåŠ¨æŒç»­å¼¹çª—
            moreBtn.style.display = 'none';
            
            // éŸ³ä¹æ§åˆ¶
            musicControl.addEventListener('click', toggleMusic);
            
            // æ¨¡æ€æ¡†å…³é—­
            closeModal.addEventListener('click', hideModal);
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    hideModal();
                }
            });
            
            // é¡µé¢åŠ è½½åç«‹å³å°è¯•è‡ªåŠ¨æ’­æ”¾éŸ³ä¹ï¼Œä¸å†ç­‰å¾…ç”¨æˆ·äº¤äº’
            attemptAutoPlay();
            
            // ä¿ç•™ç”¨æˆ·äº¤äº’ç›‘å¬å™¨ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ
            document.addEventListener('click', attemptAutoPlay);
            document.addEventListener('touchstart', attemptAutoPlay);
            document.addEventListener('keydown', attemptAutoPlay);
        });
        
        // ===== é¼ æ ‡äº¤äº’æ•ˆæœ =====
        // åŠŸèƒ½ï¼šä¸ºå¡ç‰‡æ·»åŠ éšé¼ æ ‡ç§»åŠ¨çš„æµ®åŠ¨æ•ˆæœï¼Œå¢å¼ºäº¤äº’ä½“éªŒ
        // åŸç†ï¼šè®¡ç®—é¼ æ ‡ä¸å¡ç‰‡ä¸­å¿ƒçš„è·ç¦»ï¼Œåº”ç”¨è½»å¾®çš„ä½ç½®åç§»
        document.addEventListener('mousemove', (e) => {
            const cards = document.querySelectorAll('.card.show');
            cards.forEach((card, index) => {
                // å¦‚æœä¸æ˜¯æ‚¬åœçŠ¶æ€æ‰åº”ç”¨æ•ˆæœ
                if (!card.matches(':hover')) {
                    const rect = card.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    const dx = (e.clientX - centerX) / 50;
                    const dy = (e.clientY - centerY) / 50;
                    
                    // è½»å¾®çš„ç§»åŠ¨æ•ˆæœ
                    const currentRotation = parseFloat(card.style.getPropertyValue('--rotation'));
                    card.style.transform = `scale(1) rotate(${currentRotation}deg) translate(${dx}px, ${dy}px)`;
                }
            });
        });
        

        
        // ===== é¡µé¢æ»šåŠ¨æ§åˆ¶ =====
        // åŠŸèƒ½ï¼šç¦ç”¨é¡µé¢æ»šåŠ¨ï¼Œé˜²æ­¢ç”¨æˆ·åœ¨å¼¹çª—è¿‡ç¨‹ä¸­æ»šåŠ¨é¡µé¢
        // ç›®çš„ï¼šç¡®ä¿å¼¹çª—æ•ˆæœçš„è¿è´¯æ€§å’Œè§†è§‰ä½“éªŒ
        document.body.style.overflow = 'hidden';
        
        // ===== å“åº”å¼å¸ƒå±€å¤„ç† =====
        // åŠŸèƒ½ï¼šçª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è°ƒæ•´å¡ç‰‡ä½ç½®ï¼Œç¡®ä¿åœ¨å¯è§†åŒºåŸŸå†…
        // ä¼˜åŒ–ï¼šä½¿ç”¨é˜²æŠ–æŠ€æœ¯é¿å…é¢‘ç¹è°ƒæ•´ï¼Œæé«˜æ€§èƒ½
        window.addEventListener('resize', () => {
            // é˜²æŠ–å¤„ç†ï¼Œé¿å…é¢‘ç¹è°ƒæ•´
            if (window.resizeTimeout) clearTimeout(window.resizeTimeout);
            window.resizeTimeout = setTimeout(() => {
                const cards = document.querySelectorAll('.card.show');
                cards.forEach((card) => {
                // åªè°ƒæ•´ä½ç½®ï¼Œä¿æŒå…¶ä»–å±æ€§ä¸å˜
                const containerRect = cardsContainer.getBoundingClientRect();
                const cardWidth = card.offsetWidth || 150;
                const cardHeight = card.offsetHeight || 100;
                
                const maxLeft = containerRect.width - cardWidth - 10;
                const maxTop = containerRect.height - cardHeight - 10;
                
                // ä¿æŒå¡ç‰‡åœ¨å¯è§åŒºåŸŸå†…
                let currentLeft = parseFloat(card.style.left);
                let currentTop = parseFloat(card.style.top);
                
                // å¦‚æœå¡ç‰‡è¶…å‡ºè¾¹ç•Œï¼Œè°ƒæ•´ä½ç½®
                if (currentLeft > maxLeft) currentLeft = maxLeft;
                if (currentTop > maxTop) currentTop = maxTop;
                
                card.style.left = `${currentLeft}px`;
                card.style.top = `${currentTop}px`;
            });
            }, 100); // 100msé˜²æŠ–å»¶è¿Ÿ
        });
        
        // åˆ›å»ºéšæœºæ¼‚æµ®çš„å¿ƒå½¢å…ƒç´ 
        function createHearts() {
            const heartsContainer = document.querySelector('.hearts-container');
            const numberOfHearts = Math.floor(window.innerWidth / 8); // æ ¹æ®å±å¹•å®½åº¦å†³å®šå¿ƒå½¢æ•°é‡ï¼Œæ¯”å¼•å¯¼é¡µå°‘ä¸€äº›
            
            for (let i = 0; i < numberOfHearts; i++) {
                const heart = document.createElement('div');
                heart.classList.add('heart');
                
                // éšæœºä½ç½®
                heart.style.left = Math.random() * 100 + 'vw';
                
                // éšæœºåŠ¨ç”»æŒç»­æ—¶é—´
                const animationDuration = 4 + Math.random() * 8; // 4-12ç§’
                heart.style.animationDuration = animationDuration + 's';
                
                // éšæœºå»¶è¿Ÿ
                heart.style.animationDelay = Math.random() * 15 + 's';
                
                // éšæœºå¤§å°
                const size = 4 + Math.random() * 10;
                heart.style.width = size + 'px';
                heart.style.height = size + 'px';
                
                // è°ƒæ•´ä¼ªå…ƒç´ å¤§å°ä»¥åŒ¹é…å¿ƒå½¢å¤§å°
                const style = document.createElement('style');
                style.innerHTML = `
                    .heart:nth-child(${i + 1}):before,
                    .heart:nth-child(${i + 1}):after {
                        width: ${size}px;
                        height: ${size}px;
                    }
                    .heart:nth-child(${i + 1}):before {
                        top: -${size / 2}px;
                    }
                    .heart:nth-child(${i + 1}):after {
                        left: -${size / 2}px;
                    }
                `;
                document.head.appendChild(style);
                
                // éšæœºé¢œè‰² - ä½¿ç”¨æ›´æŸ”å’Œçš„ç²‰è‰²ç³»
                const hue = Math.floor(Math.random() * 40) + 330; // ç²‰ç´«è‰²åˆ°çº¢è‰²çš„èŒƒå›´
                const saturation = Math.floor(Math.random() * 30) + 70; // 70-100%
                const lightness = Math.floor(Math.random() * 20) + 65; // 65-85%
                heart.style.backgroundColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                
                heartsContainer.appendChild(heart);
                
                // åŠ¨ç”»ç»“æŸåé‡æ–°åˆ›å»º
                heart.addEventListener('animationend', () => {
                    heart.remove();
                    setTimeout(() => {
                        // éšæœºå†³å®šæ˜¯å¦åˆ›å»ºæ–°çš„å¿ƒå½¢ï¼Œé¿å…æ•°é‡è¿‡å¤š
                        if (Math.random() > 0.3) {
                            createHearts();
                        }
                    }, Math.random() * 2000);
                });
            }
        }
        
        // åœ¨é¡µé¢åŠ è½½å®Œæˆååˆ›å»ºå¿ƒå½¢èƒŒæ™¯
        window.addEventListener('DOMContentLoaded', createHearts);
    </script>
    
    <!-- å¯¼èˆªæŒ‰é’®åŒºåŸŸ -->
    <div style="position: fixed; bottom: 20px; left: 0; right: 0; display: flex; justify-content: space-around; z-index: 1000; padding: 0 20px;">
        <!-- è¿”å›å¼•å¯¼é¡µæŒ‰é’® -->
        <button style="
            background: linear-gradient(135deg, #ff6b81, #ffa502);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            box-shadow: 0 4px 10px rgba(255, 107, 129, 0.3);
            transition: all 0.3s ease;
        " onclick="window.location.href='guide.html'">
            â† è¿”å›
        </button>
        
        <!-- å‰å¾€è¯—æ­Œé¡µé¢æŒ‰é’® -->
        <button style="
            background: linear-gradient(135deg, #7b68ee, #9370db);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 6px 15px rgba(123, 104, 238, 0.4);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        " onclick="window.location.href='poem.html'">
            å‹è°Šé•¿è¯—
        </button>
    </div>
    
    <style>
        @keyframes pulse {
            0% {
                box-shadow: 0 6px 15px rgba(123, 104, 238, 0.4);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 6px 25px rgba(123, 104, 238, 0.6);
                transform: scale(1.05);
            }
            100% {
                box-shadow: 0 6px 15px rgba(123, 104, 238, 0.4);
                transform: scale(1);
            }
        }
    </style>
</body>
</html>